<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width = device-width, initial-scale = 1">

    <title>Mechanism Browser</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<div class="top-nav">
    <div class="container">
        <div class="page-header">
            <h1>Mechanism Browser</h1>
        </div>
    </div>
    <div class="container">
        <div class="row">
            <form class="column">
                <h2>Input</h2>

                <div class="form-group row">
                    <label for="inputR1" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/r1.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="inputR1" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio7" id="inputR1on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active checked">
                                <input type="radio" name="radio7" id="inputR1neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio7" id="inputR1off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="inputR2" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/r2.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="inputR2" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio2" id="inputR2on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio2" id="inputR2neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio2" id="inputR2off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="inputR3" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/r3.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="inputR3" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio3" id="inputR3on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio3" id="inputR3neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio3" id="inputR3off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="inputT1" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/t1.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="inputT1" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio4" id="inputT1on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio4" id="inputT1neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio4" id="inputT1off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="inputT2" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/t2.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="inputT2" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio5" id="inputT2on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio5" id="inputT2neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio5" id="inputT2off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="inputT3" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/t3.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="inputT3" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio6" id="inputT3on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio6" id="inputT3neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio6" id="inputT3off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>
            </form>
            <form class="column">
                <h2>Output</h2>

                <div class="form-group row">
                    <label for="outputR1" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/r1.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="outputR1" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio7" id="outputR1on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio7" id="outputR1neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio7" id="outputR1off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="outputR2" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/r2.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="outputR2" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio8" id="outputR2on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio8" id="outputR2neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio8" id="outputR2off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="outputR3" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/r3.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="outputR3" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio9" id="outputR3on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio9" id="outputR3neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio9" id="outputR3off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="outputT1" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/t1.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="outputT1" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio10" id="outputT1on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio10" id="outputT1neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio10" id="outputT1off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="outputT2" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/t2.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="outputT2" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio11" id="outputT2on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio11" id="outputT2neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio11" id="outputT2off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="form-group row">
                    <label for="outputT3" class="col-sm-2 col-form-label">
                        <img class="icon" src="icons/t3.png" align="left">
                    </label>
                    <div class="col-sm-10">
                        <div class="btn-group btn-group-toggle" id="outputT3" data-toggle="buttons">
                            <label class="btn btn-secondary positive">
                                <input type="radio" name="radio12" id="outputT3on" autocomplete="off" value="1">
                                <i class="glyphicon glyphicon-ok"></i>
                            </label>

                            <label class="btn btn-secondary neutral active">
                                <input type="radio" name="radio12" id="outputT3neutral" autocomplete="off" value="" checked="checked">
                                <i class="glyphicon glyphicon-minus"></i>
                            </label>

                            <label class="btn btn-secondary negative">
                                <input type="radio" name="radio12" id="outputT3off" autocomplete="off" value="0">
                                <i class="glyphicon glyphicon-remove"></i>
                            </label>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div class="form-group row">
            <label for="transmission" class="col-sm-2 col-form-label">
                Transmission
            </label>
            <div class="col-sm-10">
                <input type="number" class="form-control" id="transmission" placeholder="number">
            </div>
        </div>

        <div class="form-group row">
            <label for="name" class="col-sm-2 col-form-label">
                Name
            </label>
            <div class="col-sm-10">
                <input type="search" class="form-control" id="name" placeholder="text">
            </div>
        </div>

        <span class="input-group-btn">
            <button class="btn btn-default"
                    type="button"
                    onclick="searchMechanism()">
                Search
            </button>
            <script>
                function getParameters() {
                    const parameters = {
                        inputR1: $('#inputR1 input:radio:checked').val(),
                        inputR2: $('#inputR2 input:radio:checked').val(),
                        inputR3: $('#inputR3 input:radio:checked').val(),
                        inputT1: $('#inputT1 input:radio:checked').val(),
                        inputT2: $('#inputT2 input:radio:checked').val(),
                        inputT3: $('#inputT3 input:radio:checked').val(),
                        outputR1: $('#outputR1 input:radio:checked').val(),
                        outputR2: $('#outputR2 input:radio:checked').val(),
                        outputR3: $('#outputR3 input:radio:checked').val(),
                        outputT1: $('#outputT1 input:radio:checked').val(),
                        outputT2: $('#outputT2 input:radio:checked').val(),
                        outputT3: $('#outputT3 input:radio:checked').val(),
                        transmission: document.querySelector("#transmission").value,
                        name: document.querySelector("#name").value
                    };

                    // remove undefined parameters
                    for (const key of Object.keys(parameters)) {
                        if (parameters[key] === "") {
                            delete parameters[key];
                        }
                    }
                    return parameters;
                }

                function getSearchQueryURL(baseURL, parameters) {
                    let url = new URL(baseURL);
                    for (const key of Object.keys(parameters)) {
                        url.searchParams.append(key, parameters[key]);
                    }
                    return url;
                }

                function searchMechanism() {
                    const xhttp = new XMLHttpRequest();
                    const parameters = getParameters();
                    const url = getSearchQueryURL('http://mechanism-browser:8000/api/mechanisms/', parameters);
                    xhttp.open('GET', url.toString());
                    xhttp.setRequestHeader('Content-type', 'application/json');
                    xhttp.send();
                    xhttp.onreadystatechange = function() {
                        if (xhttp.readyState == 4 && xhttp.status == 200) {
                            const response = JSON.parse(xhttp.responseText);
                            const list = document.getElementById('mechanisms');
                            list.innerHTML = '';

                            // https://stackoverflow.com/a/41447500/8816968
                            for (const mechanismId of Object.keys(response.results)) {
                                const mechanism = response.results[mechanismId];
                                const entry = document.querySelector("div[data-type='template']").cloneNode(true);
                                entry.querySelector("a.mechanism-name").textContent = mechanism.name;
                                entry.querySelector("a.mechanism-name").href = "mechanism/" + mechanism.id;
                                entry.querySelector("a.image-link").href = "mechanism/" + mechanism.id;
                                entry.querySelector("img").src = mechanism.image.substring(1);
                                entry.querySelector("div.mechanism-description").textContent = mechanism.comments;
                                entry.querySelector("a.mechanism-link").textContent = mechanism.link;
                                entry.querySelector("a.mechanism-link").href = mechanism.link;
                                entry.querySelector("div.mechanism-parameters").textContent = "Transmission: " + mechanism.transmission;
                                entry.style.display = "block";
                                list.appendChild(entry);
                            }
                        }
                    };
                }

                $('input[type=radio], input[type=number], input[type=search]').on('change keydown paste input', function() {
                    searchMechanism()
                });
                </script>
        </span>
    </div>
</div>

<br/>

<div style="display: none" data-type="template" class="search-result">
    <a class="mechanism-name">
        title
    </a>
    <div>
        <a class="image-link"><img class="preview-image" align="left"></a>
        <a class="mechanism-link">
            link
        </a>
        <div class="mechanism-description">
            description
        </div>
        <div class="mechanism-parameters">
            parameters
        </div>
    </div>
</div>
<div class="container">
    <div id="mechanisms" class="column">
    </div>
</div>
</body>
</html>
